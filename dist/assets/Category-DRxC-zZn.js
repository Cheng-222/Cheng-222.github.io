import{g as f,i as b,j as E,k as v,a as I}from"./storage-CeQ8XAxi.js";import{_ as A,c as a,a as r,e as g,t as d,b as u,f as p,v as m,F as y,r as w,o as c,n as k,w as C}from"./index-CCxU4HIp.js";const x={name:"Category",data(){return{articles:[],categories:[{id:1,name:"技术分享",description:"分享前端、后端、算法等技术文章"},{id:2,name:"生活随笔",description:"记录生活中的点点滴滴"},{id:3,name:"读书笔记",description:"阅读心得和知识总结"},{id:4,name:"项目经验",description:"项目开发中的经验和教训"}],currentPage:1,totalPages:1,showAddPanel:!1,showEditPanel:!1,editingArticleId:null,newTitle:"",newExcerpt:"",newTags:"",newContent:"",newCover:"",coverMaxBytes:500*1024,coverError:"",editorHtml:"",editorError:"",editorImageMaxBytes:500*1024}},computed:{currentCategory(){const n=parseInt(this.$route.params.id);return this.categories.find(t=>t.id===n)}},created(){this.fetchCategoryArticles()},watch:{"$route.params.id":function(){this.currentPage=1,this.fetchCategoryArticles()}},methods:{async fetchCategoryArticles(){try{const n=parseInt(this.$route.params.id)||1,o=f().filter(i=>i.categoryId===n).map(i=>({...i,publishTime:new Date(i.publishTime),tags:Array.isArray(i.tags)?i.tags:typeof i.tags=="string"?i.tags.split(","):[]}));this.categories=I(),this.totalPages=Math.ceil(o.length/10)||1;const l=(this.currentPage-1)*10;this.articles=o.slice(l,l+10)}catch(n){console.error("加载分类文章失败:",n)}},formatDate(n){const t=new Date(n);return`${t.getFullYear()}-${String(t.getMonth()+1).padStart(2,"0")}-${String(t.getDate()).padStart(2,"0")}`},getCategoryName(n){const t=this.categories.find(o=>o.id===n);return t?t.name:"未分类"},goToArticle(n){this.$router.push(`/article/${n}`)},goToTag(n){this.$router.push(`/tags/${n}`)},prevPage(){this.currentPage>1&&(this.currentPage--,this.fetchCategoryArticles())},nextPage(){this.currentPage<this.totalPages&&(this.currentPage++,this.fetchCategoryArticles())},toggleAddArticle(){this.showAddPanel=!this.showAddPanel},saveNewArticle(){const n=parseInt(this.$route.params.id)||1;if(!this.newTitle.trim()){alert("请填写标题");return}const t=f(),o=t.length?Math.max(...t.map(h=>h.id))+1:1,l=(this.newTags||"").split(",").map(h=>h.trim()).filter(Boolean),s=`<div class="rich-content">${this.$refs.rtEditor?this.$refs.rtEditor.innerHTML:this.editorHtml||""}</div>`,e={id:o,title:this.newTitle.trim(),publishTime:new Date().toISOString(),categoryId:n,excerpt:this.newExcerpt.trim(),tags:l,views:0,comments:0,content:s,cover:this.newCover||""};v([e,...t]),this.showAddPanel=!1,this.newTitle="",this.newExcerpt="",this.newTags="",this.newContent="",this.editorHtml="",this.$refs.rtEditor&&(this.$refs.rtEditor.innerHTML=""),this.newCover="",alert("文章已添加"),this.fetchCategoryArticles()},onCoverChange(n){const t=n.target.files&&n.target.files[0];if(!t)return;const o=this.coverMaxBytes;if(t.size>o){const i=Math.round(t.size/1024),s=Math.round(o/1024);this.coverError=`图片过大：${i}KB，最大${s}KB`,this.newCover="",this.$refs.coverInput&&(this.$refs.coverInput.value="");return}this.coverError="";const l=new FileReader;l.onload=()=>{this.newCover=l.result},l.readAsDataURL(t)},clearCover(){this.newCover="",this.$refs.coverInput&&(this.$refs.coverInput.value="")},onEditorInput(){const n=this.$refs.rtEditor;this.editorHtml=n?n.innerHTML:""},applyFormat(n){this.focusEditor(),document.execCommand(n,!1,null)},applyHeading(n){this.focusEditor(),document.execCommand("formatBlock",!1,n)},insertInlineCode(){this.focusEditor();const n=window.getSelection();if(!n||n.rangeCount===0)return;const t=n.getRangeAt(0),o=document.createElement("code");o.textContent=t.toString()||"code",t.deleteContents(),t.insertNode(o)},insertCodeBlock(){this.focusEditor();const n=document.createElement("pre"),t=document.createElement("code");t.textContent=`/* 在此编写代码 */
`,n.appendChild(t);const o=window.getSelection();if(o&&o.rangeCount>0){const l=o.getRangeAt(0);l.collapse(!1),l.insertNode(n)}else this.$refs.rtEditor&&this.$refs.rtEditor.appendChild(n)},triggerInsertImage(){this.editorError="",this.$refs.rtImageInput&&this.$refs.rtImageInput.click()},onEditorImageChange(n){const t=n.target.files&&n.target.files[0];if(!t)return;const o=this.editorImageMaxBytes;if(t.size>o){const i=Math.round(t.size/1024),s=Math.round(o/1024);this.editorError=`图片过大：${i}KB，最大${s}KB`,this.$refs.rtImageInput&&(this.$refs.rtImageInput.value="");return}const l=new FileReader;l.onload=()=>{const i=document.createElement("img");i.src=l.result,i.alt="插入图片",i.style.maxWidth="100%",i.style.display="block",i.style.borderRadius="6px",i.style.width="100%";const s=window.getSelection();if(s&&s.rangeCount>0){const e=s.getRangeAt(0);e.collapse(!1),e.insertNode(i),this.focusEditor()}else this.$refs.rtEditor&&(this.$refs.rtEditor.appendChild(i),this.focusEditor());this.onEditorInput()},l.readAsDataURL(t)},focusEditor(){const n=this.$refs.rtEditor;n&&n.focus()},startEditArticle(n){this.showAddPanel=!1,this.showEditPanel=!0,this.editingArticleId=n.id,this.newTitle=n.title,this.newExcerpt=n.excerpt||"",this.newTags=Array.isArray(n.tags)?n.tags.join(", "):n.tags||"",this.newCover=n.cover||"";let t="";if(n.content){const o=/<div class="rich-content">([\s\S]*?)<\/div>/.exec(n.content);t=o?o[1]:n.content}this.editorHtml=t,this.$nextTick(()=>{this.$refs.rtEditor&&(this.$refs.rtEditor.innerHTML=this.editorHtml||""),this.focusEditor()})},cancelEdit(){this.showEditPanel=!1,this.editingArticleId=null,this.newTitle="",this.newExcerpt="",this.newTags="",this.newCover="",this.editorHtml="",this.$refs.rtEditor&&(this.$refs.rtEditor.innerHTML="")},saveEditedArticle(){if(!this.editingArticleId)return;if(!this.newTitle.trim()){alert("请填写标题");return}const n=f(),t=n.findIndex(e=>e.id===this.editingArticleId);if(t===-1){alert("文章不存在或已被删除");return}const o=(this.newTags||"").split(",").map(e=>e.trim()).filter(Boolean),i=`<div class="rich-content">${this.$refs.rtEditor?this.$refs.rtEditor.innerHTML:this.editorHtml||""}</div>`,s=n[t];n[t]={...s,title:this.newTitle.trim(),excerpt:this.newExcerpt.trim(),tags:o,content:i,cover:this.newCover||""},v(n),this.showEditPanel=!1,this.editingArticleId=null,alert("文章已更新"),this.fetchCategoryArticles()},deleteArticle(n){const t=f(),o=t.filter(i=>i.id!==n);if(o.length===t.length)return;const l=b();l&&l[n]&&(delete l[n],E(l)),v(o),this.editingArticleId===n&&this.cancelEdit(),this.fetchCategoryArticles(),alert("文章已删除")}}},T={class:"category-container"},P={class:"category-header"},B={class:"category-title"},M={class:"category-description"},H={class:"header-actions"},S={key:0,class:"add-article-panel"},N={key:0,class:"input-error"},V={key:1,class:"cover-preview"},_=["src"],z={class:"full-row"},D={class:"full-row"},F={class:"rt-toolbar"},K={key:0,class:"input-error"},L={key:1,class:"add-article-panel"},R={class:"article-preview"},U={key:0,class:"cover-preview"},j=["src"],X={style:{display:"flex",gap:".5rem","margin-top":".5rem"}},O={key:0,class:"input-error"},W={class:"full-row"},Y={class:"rt-toolbar"},q={key:0,class:"input-error"},G={class:"full-row",style:{display:"flex",gap:".6rem","justify-content":"flex-end"}},J={class:"main-content"},Q={class:"content-wrapper"},Z=["onClick"],$={class:"article-header"},tt={class:"article-title"},et={class:"article-meta"},rt={class:"publish-time"},st={class:"card-actions"},nt=["onClick"],it=["onClick"],ot=["src"],lt={class:"article-excerpt"},at={class:"article-footer"},dt={class:"article-tags"},ct=["onClick"],ut={class:"article-stats"},gt={class:"stat-item"},ht={class:"stat-item"},pt={class:"pagination"},mt=["disabled"],ft={class:"page-info"},vt=["disabled"];function Ct(n,t,o,l,i,s){return c(),a("div",T,[r("div",P,[r("h1",B,d(s.currentCategory?s.currentCategory.name:"未分类"),1),r("p",M,d(s.currentCategory?s.currentCategory.description:"查看所有文章分类"),1),r("div",H,[s.currentCategory&&s.currentCategory.id===1?(c(),a("button",{key:0,class:"btn success",onClick:t[0]||(t[0]=(...e)=>s.toggleAddArticle&&s.toggleAddArticle(...e))},d(i.showAddPanel?"取消":"添加文章"),1)):g("",!0),i.showAddPanel?(c(),a("button",{key:1,class:"btn primary",onClick:t[1]||(t[1]=(...e)=>s.saveNewArticle&&s.saveNewArticle(...e))},"保存")):g("",!0)]),i.showAddPanel?(c(),a("div",S,[r("label",null,[t[32]||(t[32]=u(" 标题 ",-1)),p(r("input",{"onUpdate:modelValue":t[2]||(t[2]=e=>i.newTitle=e),placeholder:"请输入文章标题"},null,512),[[m,i.newTitle]])]),r("label",null,[t[33]||(t[33]=u(" 标签（逗号分隔） ",-1)),p(r("input",{"onUpdate:modelValue":t[3]||(t[3]=e=>i.newTags=e),placeholder:"如：Vue3, 前端开发"},null,512),[[m,i.newTags]])]),r("label",null,[t[34]||(t[34]=u(" 封面图片 ",-1)),r("input",{type:"file",accept:"image/*",onChange:t[4]||(t[4]=(...e)=>s.onCoverChange&&s.onCoverChange(...e)),ref:"coverInput"},null,544),t[35]||(t[35]=r("small",{class:"input-help"},"建议不超过500KB，过大将无法添加",-1)),i.coverError?(c(),a("div",N,d(i.coverError),1)):g("",!0),i.newCover?(c(),a("div",V,[r("img",{src:i.newCover,alt:"封面预览"},null,8,_),r("button",{type:"button",class:"btn danger small",onClick:t[5]||(t[5]=(...e)=>s.clearCover&&s.clearCover(...e))},"移除封面")])):g("",!0)]),r("label",z,[t[36]||(t[36]=u(" 摘要 ",-1)),p(r("textarea",{"onUpdate:modelValue":t[6]||(t[6]=e=>i.newExcerpt=e),rows:"2",placeholder:"一句话摘要"},null,512),[[m,i.newExcerpt]])]),r("label",D,[t[37]||(t[37]=u(" 正文 ",-1)),r("div",F,[r("button",{type:"button",class:"btn",onClick:t[7]||(t[7]=e=>s.applyFormat("bold"))},"加粗"),r("button",{type:"button",class:"btn",onClick:t[8]||(t[8]=e=>s.applyFormat("italic"))},"斜体"),r("button",{type:"button",class:"btn",onClick:t[9]||(t[9]=e=>s.applyHeading("h2"))},"小标题"),r("button",{type:"button",class:"btn",onClick:t[10]||(t[10]=(...e)=>s.insertInlineCode&&s.insertInlineCode(...e))},"行内代码"),r("button",{type:"button",class:"btn",onClick:t[11]||(t[11]=(...e)=>s.insertCodeBlock&&s.insertCodeBlock(...e))},"代码块"),r("button",{type:"button",class:"btn",onClick:t[12]||(t[12]=(...e)=>s.triggerInsertImage&&s.triggerInsertImage(...e))},"插入图片"),r("input",{ref:"rtImageInput",type:"file",accept:"image/*",class:"hidden-input",onChange:t[13]||(t[13]=(...e)=>s.onEditorImageChange&&s.onEditorImageChange(...e))},null,544)]),r("div",{class:"rt-editor",ref:"rtEditor",contenteditable:"true",onInput:t[14]||(t[14]=(...e)=>s.onEditorInput&&s.onEditorInput(...e)),placeholder:"在此输入正文，支持代码与图片"},null,544),i.editorError?(c(),a("div",K,d(i.editorError),1)):g("",!0)])])):g("",!0),i.showEditPanel?(c(),a("div",L,[r("label",null,[t[38]||(t[38]=u(" 标题 ",-1)),p(r("input",{"onUpdate:modelValue":t[15]||(t[15]=e=>i.newTitle=e),type:"text",placeholder:"输入文章标题"},null,512),[[m,i.newTitle]])]),r("label",null,[t[39]||(t[39]=u(" 标签（逗号分隔） ",-1)),p(r("input",{"onUpdate:modelValue":t[16]||(t[16]=e=>i.newTags=e),type:"text",placeholder:"如：Vue3, Composition API"},null,512),[[m,i.newTags]])]),r("label",null,[t[40]||(t[40]=u(" 封面图片 ",-1)),r("div",R,[i.newCover?(c(),a("div",U,[r("img",{src:i.newCover,alt:"封面预览"},null,8,j)])):g("",!0)]),r("div",X,[r("input",{ref:"coverInput",type:"file",accept:"image/*",onChange:t[17]||(t[17]=(...e)=>s.onCoverChange&&s.onCoverChange(...e))},null,544),r("button",{type:"button",class:"btn",onClick:t[18]||(t[18]=(...e)=>s.clearCover&&s.clearCover(...e))},"清除封面")]),i.coverError?(c(),a("div",O,d(i.coverError),1)):g("",!0)]),r("label",null,[t[41]||(t[41]=u(" 摘要 ",-1)),p(r("textarea",{"onUpdate:modelValue":t[19]||(t[19]=e=>i.newExcerpt=e),rows:"2",placeholder:"一句话摘要"},null,512),[[m,i.newExcerpt]])]),r("label",W,[t[42]||(t[42]=u(" 正文 ",-1)),r("div",Y,[r("button",{type:"button",class:"btn",onClick:t[20]||(t[20]=e=>s.applyFormat("bold"))},"加粗"),r("button",{type:"button",class:"btn",onClick:t[21]||(t[21]=e=>s.applyFormat("italic"))},"斜体"),r("button",{type:"button",class:"btn",onClick:t[22]||(t[22]=e=>s.applyHeading("h2"))},"小标题"),r("button",{type:"button",class:"btn",onClick:t[23]||(t[23]=(...e)=>s.insertInlineCode&&s.insertInlineCode(...e))},"行内代码"),r("button",{type:"button",class:"btn",onClick:t[24]||(t[24]=(...e)=>s.insertCodeBlock&&s.insertCodeBlock(...e))},"代码块"),r("button",{type:"button",class:"btn",onClick:t[25]||(t[25]=(...e)=>s.triggerInsertImage&&s.triggerInsertImage(...e))},"插入图片"),r("input",{ref:"rtImageInput",type:"file",accept:"image/*",class:"hidden-input",onChange:t[26]||(t[26]=(...e)=>s.onEditorImageChange&&s.onEditorImageChange(...e))},null,544)]),r("div",{class:"rt-editor",ref:"rtEditor",contenteditable:"true",onInput:t[27]||(t[27]=(...e)=>s.onEditorInput&&s.onEditorInput(...e)),placeholder:"在此输入正文，支持代码与图片"},null,544),i.editorError?(c(),a("div",q,d(i.editorError),1)):g("",!0)]),r("div",G,[r("button",{class:"btn",onClick:t[28]||(t[28]=(...e)=>s.cancelEdit&&s.cancelEdit(...e))},"取消"),r("button",{class:"btn success",onClick:t[29]||(t[29]=(...e)=>s.saveEditedArticle&&s.saveEditedArticle(...e))},"保存修改")])])):g("",!0)]),r("div",J,[r("div",Q,[(c(!0),a(y,null,w(i.articles,e=>(c(),a("article",{key:e.id,class:"article-card",onClick:h=>s.goToArticle(e.id)},[r("div",$,[r("h2",tt,d(e.title),1),r("div",et,[r("span",rt,d(s.formatDate(e.publishTime)),1),r("span",{class:k(["category",`category-${e.categoryId}`])},d(s.getCategoryName(e.categoryId)),3)]),r("div",st,[r("button",{class:"btn",onClick:C(h=>s.startEditArticle(e),["stop"])},"编辑",8,nt),r("button",{class:"btn",style:{color:"#fff",background:"#ef4444","border-color":"#ef4444"},onClick:C(h=>s.deleteArticle(e.id),["stop"])},"删除",8,it)])]),e.cover?(c(),a("img",{key:0,src:e.cover,alt:"封面",class:"article-cover"},null,8,ot)):g("",!0),r("div",lt,d(e.excerpt),1),r("div",at,[r("div",dt,[(c(!0),a(y,null,w(e.tags,h=>(c(),a("span",{key:h,class:"tag",onClick:C(yt=>s.goToTag(h),["stop"])}," #"+d(h),9,ct))),128))]),r("div",ut,[r("div",gt,[t[43]||(t[43]=r("svg",{class:"icon",viewBox:"0 0 16 16",fill:"currentColor"},[r("path",{d:"M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.012 8.012 0 0 0 16 8c0-4.42-3.58-8-8-8z"})],-1)),u(" "+d(e.views),1)]),r("div",ht,[t[44]||(t[44]=r("svg",{class:"icon",viewBox:"0 0 16 16",fill:"currentColor"},[r("path",{d:"M2.678 11.894a1 1 0 0 1 .287.801 10.97 10.97 0 0 0 .398 2c1.395-.323 2.247-.697 2.634-.893a1 1 0 0 1 .71-.074A8.06 8.06 0 0 0 8 14c3.996 0 7-2.807 7-6 0-3.192-3.004-6-7-6S1 4.808 1 8c0 1.468.617 2.83 1.678 3.894zm-.493 3.905a21.682 21.682 0 0 1-.713.129c-.2.032-.352-.176-.273-.362a9.68 9.68 0 0 0 .244-.637l.003-.01c.248-.72.45-1.548.524-2.319C.743 11.37 0 9.76 0 8c0-3.866 3.582-7 8-7s8 3.134 8 7-3.582 7-8 7a9.06 9.06 0 0 1-2.347-.306c-.52.263-1.639.742-3.468 1.105z"})],-1)),u(" "+d(e.comments),1)])])])],8,Z))),128)),r("div",pt,[r("button",{class:"page-btn",onClick:t[30]||(t[30]=(...e)=>s.prevPage&&s.prevPage(...e)),disabled:i.currentPage===1},"上一页",8,mt),r("span",ft,"第 "+d(i.currentPage)+" / "+d(i.totalPages)+" 页",1),r("button",{class:"page-btn",onClick:t[31]||(t[31]=(...e)=>s.nextPage&&s.nextPage(...e)),disabled:i.currentPage===i.totalPages},"下一页",8,vt)])])])])}const Et=A(x,[["render",Ct],["__scopeId","data-v-6a686a0d"]]);export{Et as default};
