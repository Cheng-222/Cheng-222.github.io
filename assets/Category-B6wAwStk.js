import{g as m,i as C,j as x,k as P,a as b}from"./storage-Dkmu0FnL.js";import"./index-C2exR0dF.js";import{_ as M,c as d,o as c,a as t,e as v,t as a,b as u,g,v as h,i as k,h as I,F as A,r as T,j as E,k as V,E as w,n as _,w as f}from"./index-DqUWjSwh.js";import{m as S}from"./MdEditor-ZQ-GO2n_.js";const U={name:"Category",components:{MdEditor:S},data(){return{articles:[],currentCategory:null,currentPage:1,pageSize:3,showAddPanel:!1,showEditPanel:!1,editingId:null,newTitle:"",newTags:"",newCover:"",newExcerpt:"",editorMarkdown:""}},computed:{totalPages(){return Math.ceil(this.articles.length/this.pageSize)||1},theme(){const n=this.currentCategory?this.currentCategory.id:0;return{1:{cssVars:{"--acc":"#0ea5e9","--acc-600":"#0284c7","--grad-start":"#06b6d4","--grad-end":"#3b82f6"},emoji:"🧠"},2:{cssVars:{"--acc":"#a855f7","--acc-600":"#7c3aed","--grad-start":"#8b5cf6","--grad-end":"#ec4899"},emoji:"🌸"},3:{cssVars:{"--acc":"#16a34a","--acc-600":"#15803d","--grad-start":"#10b981","--grad-end":"#22c55e"},emoji:"🔗"},4:{cssVars:{"--acc":"#f59e0b","--acc-600":"#d97706","--grad-start":"#f59e0b","--grad-end":"#f97316"},emoji:"🚀"}}[n]||{cssVars:{"--acc":"#667eea","--acc-600":"#5a67d8","--grad-start":"#667eea","--grad-end":"#764ba2"},emoji:"📄"}}},created(){this.loadCategoryAndArticles()},watch:{"$route.params.id":function(){this.currentPage=1,this.loadCategoryAndArticles()}},methods:{loadCategoryAndArticles(){const n=parseInt(this.$route.params.id),e=b();this.currentCategory=e.find(o=>o.id===n)||{id:n,name:"未分类",description:"查看所有文章分类"};const l=m().filter(o=>o.categoryId===n);this.articles=l.sort((o,r)=>new Date(r.publishTime)-new Date(o.publishTime))},formatDate(n){const e=new Date(n);return`${e.getFullYear()}-${String(e.getMonth()+1).padStart(2,"0")}-${String(e.getDate()).padStart(2,"0")}`},getCategoryName(n){const l=b().find(o=>o.id===n);return l?l.name:"未分类"},prevPage(){this.currentPage>1&&(this.currentPage-=1)},nextPage(){const n=this.totalPages;this.currentPage<n&&(this.currentPage+=1)},toggleAddArticle(){this.showAddPanel=!this.showAddPanel},saveNewArticle(){if(!this.newTitle.trim()){w.warning("请输入标题");return}const n=this.newTags.split(",").map(o=>o.trim()).filter(Boolean),e=m(),l=e.length?Math.max(...e.map(o=>o.id))+1:1;e.push({id:l,title:this.newTitle,publishTime:new Date().toISOString(),categoryId:this.currentCategory?this.currentCategory.id:1,excerpt:this.newExcerpt||"",content:this.editorMarkdown||"",cover:this.newCover||"",tags:n,views:0,comments:0}),C(e),this.articles=e.filter(o=>o.categoryId===(this.currentCategory?this.currentCategory.id:1)),this.showAddPanel=!1,this.newTitle="",this.newTags="",this.newCover="",this.newExcerpt="",this.editorMarkdown="",this.$refs.coverInput&&(this.$refs.coverInput.value=""),w.success("已添加新文章")},startEditArticle(n){this.showEditPanel=!0,this.editingId=n.id,this.newTitle=n.title,this.newTags=Array.isArray(n.tags)?n.tags.join(","):typeof n.tags=="string"?n.tags:"",this.newCover=n.cover||"",this.editorMarkdown=n.content||""},cancelEdit(){this.showEditPanel=!1,this.editingId=null,this.newTitle="",this.newTags="",this.newCover="",this.editorMarkdown="",this.$refs.coverInput&&(this.$refs.coverInput.value="")},saveEditedArticle(){if(!this.newTitle.trim()){w.warning("请输入标题");return}const n=this.newTags.split(",").map(o=>o.trim()).filter(Boolean),e=m(),l=e.findIndex(o=>o.id===this.editingId);l>=0?(e[l]={...e[l],title:this.newTitle,tags:n,cover:this.newCover||"",content:this.editorMarkdown||""},C(e),this.articles=e.filter(o=>o.categoryId===(this.currentCategory?this.currentCategory.id:1)),this.showEditPanel=!1,this.editingId=null,this.newTitle="",this.newTags="",this.newCover="",this.editorMarkdown="",this.$refs.coverInput&&(this.$refs.coverInput.value=""),w.success("已保存修改")):w.warning("未找到要编辑的文章")},async deleteArticle(n){try{await V.confirm("确定删除该文章？","提示",{type:"warning"})}catch{return}const e=m().filter(o=>o.id!==n);C(e),this.articles=e.filter(o=>o.categoryId===(this.currentCategory?this.currentCategory.id:1));const l=x();l[n]&&(delete l[n],P(l)),w.success("已删除")},onCoverChange(n){const e=n.target.files&&n.target.files[0];if(!e)return;const l=new FileReader;l.onload=()=>{this.newCover=l.result},l.readAsDataURL(e)},clearCover(){this.newCover="",this.$refs.coverInput&&(this.$refs.coverInput.value="")},goToArticle(n){this.$router.push(`/article/${n}`)},goToTag(n){this.$router.push(`/tags/${n}`)}}},j={class:"category-header"},D={class:"category-emoji"},z={class:"category-title"},B={class:"category-description"},L={class:"header-actions"},N={key:0,class:"add-article-panel"},F={key:0,class:"cover-preview"},R=["src"],q={class:"full-row"},O={class:"full-row"},Y={class:"full-row",style:{display:"flex",gap:".6rem","justify-content":"flex-end"}},G={key:1,class:"add-article-panel"},H={key:0,class:"cover-preview"},J=["src"],K={class:"full-row"},Q={class:"full-row",style:{display:"flex",gap:".6rem","justify-content":"flex-end"}},W={class:"main-content"},X={class:"content-wrapper"},Z=["onClick"],$={class:"article-header"},ee={class:"article-title"},te={class:"article-meta"},se={class:"publish-time"},re={class:"card-actions"},ne=["onClick"],ie=["onClick"],oe=["src"],le={class:"article-excerpt"},ae={class:"article-footer"},de={class:"article-tags"},ce=["onClick"],ue={class:"article-stats"},ge={class:"stat-item"},he={class:"stat-item"},pe={class:"pagination"},ve=["disabled"],we={class:"page-info"},me=["disabled"];function Ce(n,e,l,o,r,i){const y=I("MdEditor");return c(),d("div",{class:"category-container",style:E(i.theme.cssVars)},[t("div",j,[t("div",D,a(i.theme.emoji),1),t("h1",z,a(r.currentCategory?r.currentCategory.name:"未分类"),1),t("p",B,a(r.currentCategory?r.currentCategory.description:"查看所有文章分类"),1),t("div",L,[r.currentCategory&&[1,2,3,4].includes(r.currentCategory.id)?(c(),d("button",{key:0,class:"btn success",onClick:e[0]||(e[0]=(...s)=>i.toggleAddArticle&&i.toggleAddArticle(...s))},a(r.showAddPanel?"取消":"添加文章"),1)):v("",!0)]),r.showAddPanel?(c(),d("div",N,[t("label",null,[e[20]||(e[20]=u(" 标题 ",-1)),g(t("input",{"onUpdate:modelValue":e[1]||(e[1]=s=>r.newTitle=s),type:"text",placeholder:"输入文章标题"},null,512),[[h,r.newTitle]])]),t("label",null,[e[21]||(e[21]=u(" 标签（逗号分隔） ",-1)),g(t("input",{"onUpdate:modelValue":e[2]||(e[2]=s=>r.newTags=s),type:"text",placeholder:"如：Vue3,前端开发"},null,512),[[h,r.newTags]])]),t("label",null,[e[22]||(e[22]=u(" 封面图（URL） ",-1)),g(t("input",{"onUpdate:modelValue":e[3]||(e[3]=s=>r.newCover=s),type:"text",placeholder:"https://..."},null,512),[[h,r.newCover]])]),t("label",null,[e[23]||(e[23]=u(" 或选择本地封面 ",-1)),t("input",{type:"file",accept:"image/*",ref:"coverInput",onChange:e[4]||(e[4]=(...s)=>i.onCoverChange&&i.onCoverChange(...s))},null,544),e[24]||(e[24]=t("span",{class:"muted"},"图片将以DataURL存储，建议不超过2MB",-1)),r.newCover?(c(),d("div",F,[t("img",{src:r.newCover,alt:"封面预览"},null,8,R),t("button",{class:"btn",onClick:e[5]||(e[5]=(...s)=>i.clearCover&&i.clearCover(...s))},"清除封面")])):v("",!0)]),t("label",q,[e[25]||(e[25]=u(" 摘要 ",-1)),g(t("textarea",{"onUpdate:modelValue":e[6]||(e[6]=s=>r.newExcerpt=s),rows:"2",placeholder:"一句话摘要"},null,512),[[h,r.newExcerpt]])]),t("div",O,[e[26]||(e[26]=t("div",null,"正文（Markdown）",-1)),k(y,{modelValue:r.editorMarkdown,"onUpdate:modelValue":e[7]||(e[7]=s=>r.editorMarkdown=s),toolbars:["title","quote","unorderedList","orderedList","code"],autoFocus:!1,placeholder:"在此输入正文，点击插入代码可添加代码块"},null,8,["modelValue"])]),t("div",Y,[t("button",{class:"btn",onClick:e[8]||(e[8]=(...s)=>i.toggleAddArticle&&i.toggleAddArticle(...s))},"取消"),t("button",{class:"btn success",onClick:e[9]||(e[9]=(...s)=>i.saveNewArticle&&i.saveNewArticle(...s))},"保存")])])):v("",!0),r.showEditPanel?(c(),d("div",G,[t("label",null,[e[27]||(e[27]=u(" 标题 ",-1)),g(t("input",{"onUpdate:modelValue":e[10]||(e[10]=s=>r.newTitle=s),type:"text",placeholder:"输入文章标题"},null,512),[[h,r.newTitle]])]),t("label",null,[e[28]||(e[28]=u(" 标签（逗号分隔） ",-1)),g(t("input",{"onUpdate:modelValue":e[11]||(e[11]=s=>r.newTags=s),type:"text",placeholder:"如：Vue3,前端开发"},null,512),[[h,r.newTags]])]),t("label",null,[e[29]||(e[29]=u(" 封面图（URL） ",-1)),g(t("input",{"onUpdate:modelValue":e[12]||(e[12]=s=>r.newCover=s),type:"text",placeholder:"https://..."},null,512),[[h,r.newCover]])]),t("label",null,[e[30]||(e[30]=u(" 或选择本地封面 ",-1)),t("input",{type:"file",accept:"image/*",ref:"coverInput",onChange:e[13]||(e[13]=(...s)=>i.onCoverChange&&i.onCoverChange(...s))},null,544),e[31]||(e[31]=t("span",{class:"muted"},"图片将以DataURL存储，建议不超过2MB",-1)),r.newCover?(c(),d("div",H,[t("img",{src:r.newCover,alt:"封面预览"},null,8,J),t("button",{class:"btn",onClick:e[14]||(e[14]=(...s)=>i.clearCover&&i.clearCover(...s))},"清除封面")])):v("",!0)]),t("div",K,[e[32]||(e[32]=t("div",null,"正文（Markdown）",-1)),k(y,{modelValue:r.editorMarkdown,"onUpdate:modelValue":e[15]||(e[15]=s=>r.editorMarkdown=s),toolbars:["title","quote","unorderedList","orderedList","code"],autoFocus:!1,placeholder:"在此输入正文，点击插入代码可添加代码块"},null,8,["modelValue"])]),t("div",Q,[t("button",{class:"btn",onClick:e[16]||(e[16]=(...s)=>i.cancelEdit&&i.cancelEdit(...s))},"取消"),t("button",{class:"btn success",onClick:e[17]||(e[17]=(...s)=>i.saveEditedArticle&&i.saveEditedArticle(...s))},"保存修改")])])):v("",!0)]),t("div",W,[t("div",X,[(c(!0),d(A,null,T(r.articles.slice((r.currentPage-1)*r.pageSize,(r.currentPage-1)*r.pageSize+r.pageSize),s=>(c(),d("article",{key:s.id,class:"article-card",onClick:p=>i.goToArticle(s.id)},[t("div",$,[t("h2",ee,a(s.title),1),t("div",te,[t("span",se,a(i.formatDate(s.publishTime)),1),t("span",{class:_(["category",`category-${s.categoryId}`])},a(i.getCategoryName(s.categoryId)),3)]),t("div",re,[t("button",{class:"btn",onClick:f(p=>i.startEditArticle(s),["stop"])},"编辑",8,ne),t("button",{class:"btn",style:{color:"#fff",background:"#ef4444","border-color":"#ef4444"},onClick:f(p=>i.deleteArticle(s.id),["stop"])},"删除",8,ie)])]),s.cover?(c(),d("img",{key:0,src:s.cover,alt:"封面",class:"article-cover"},null,8,oe)):v("",!0),t("div",le,a(s.excerpt),1),t("div",ae,[t("div",de,[(c(!0),d(A,null,T(s.tags,p=>(c(),d("span",{key:p,class:"tag",onClick:f(fe=>i.goToTag(p),["stop"])}," #"+a(p),9,ce))),128))]),t("div",ue,[t("div",ge,[e[33]||(e[33]=t("svg",{class:"icon",viewBox:"0 0 16 16",fill:"currentColor"},[t("path",{d:"M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.012 8.012 0 0 0 16 8c0-4.42-3.58-8-8-8z"})],-1)),u(" "+a(s.views),1)]),t("div",he,[e[34]||(e[34]=t("svg",{class:"icon",viewBox:"0 0 16 16",fill:"currentColor"},[t("path",{d:"M2.678 11.894a1 1 0 0 1 .287.801 10.97 10.97 0 0 0 .398 2c1.395-.323 2.247-.697 2.634-.893a1 1 0 0 1 .71-.074A8.06 8.06 0 0 0 8 14c3.996 0 7-2.807 7-6 0-3.192-3.004-6-7-6S1 4.808 1 8c0 1.468.617 2.83 1.678 3.894zm-.493 3.905a21.682 21.682 0 0 1-.713.129c-.2.032-.352-.176-.273-.362a9.68 9.68 0 0 0 .244-.637l.003-.01c.248-.72.45-1.548.524-2.319C.743 11.37 0 9.76 0 8c0-3.866 3.582-7 8-7s8 3.134 8 7-3.582 7-8 7a9.06 9.06 0 0 1-2.347-.306c-.52.263-1.639.742-3.468 1.105z"})],-1)),u(" "+a(s.comments),1)])])])],8,Z))),128)),t("div",pe,[t("button",{class:"page-btn",onClick:e[18]||(e[18]=(...s)=>i.prevPage&&i.prevPage(...s)),disabled:r.currentPage===1},"上一页",8,ve),t("span",we,"第 "+a(r.currentPage)+" / "+a(i.totalPages)+" 页",1),t("button",{class:"page-btn",onClick:e[19]||(e[19]=(...s)=>i.nextPage&&i.nextPage(...s)),disabled:r.currentPage===i.totalPages},"下一页",8,me)])])])],4)}const Te=M(U,[["render",Ce],["__scopeId","data-v-d5fb90fc"]]);export{Te as default};
