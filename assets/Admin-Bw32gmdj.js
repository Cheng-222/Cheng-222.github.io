import{s as C,i as y,m as V,k,j as I,g as F,h as D,a as M}from"./storage-Dkmu0FnL.js";import"./index-C2exR0dF.js";import{_ as T,c as a,o as d,a as e,e as c,n as b,b as n,g as m,v as u,F as A,r as w,t as p,i as L,h as N,E as v,k as x}from"./index-DqUWjSwh.js";import{m as E}from"./MdEditor-ZQ-GO2n_.js";const O={name:"Admin",components:{MdEditor:E},data(){return{tab:"profile",profile:{name:"",title:"",email:"",wechat:"",intro:""},articles:[],categories:[],articleForm:{id:null,title:"",categoryId:1,excerpt:"",content:"",tagsInput:"",cover:""},categoryForm:{id:null,name:"",description:""},dumpText:""}},mounted(){this.loadAll()},methods:{loadAll(){this.profile=D(),this.articles=F(),this.categories=M(),this.refreshDump()},saveProfile(){C(this.profile),v.success("资料已保存")},editArticle(o){this.tab="articles";const t=Array.isArray(o.tags)?o.tags:typeof o.tags=="string"?o.tags.split(","):[];this.articleForm={id:o.id,title:o.title,categoryId:o.categoryId,excerpt:o.excerpt,content:o.content||"",tagsInput:t.join(","),cover:o.cover||""}},resetArticleForm(){this.articleForm={id:null,title:"",categoryId:1,excerpt:"",content:"",tagsInput:"",cover:""},this.$refs.adminCoverInput&&(this.$refs.adminCoverInput.value="")},saveArticle(){const o=this.articleForm.tagsInput.split(",").map(s=>s.trim()).filter(Boolean),t=F();if(this.articleForm.id){const s=t.findIndex(g=>g.id===this.articleForm.id);s>=0&&(t[s]={...t[s],title:this.articleForm.title,categoryId:this.articleForm.categoryId,excerpt:this.articleForm.excerpt,content:this.articleForm.content,cover:this.articleForm.cover||"",tags:o})}else{const s=t.length?Math.max(...t.map(g=>g.id))+1:1;t.push({id:s,title:this.articleForm.title,publishTime:new Date().toISOString(),categoryId:this.articleForm.categoryId,excerpt:this.articleForm.excerpt,content:this.articleForm.content,cover:this.articleForm.cover||"",tags:o,views:0,comments:0})}y(t),this.articles=t,this.resetArticleForm(),v.success("文章已保存")},async deleteArticle(o){try{await x.confirm("确定删除该文章？","提示",{type:"warning"})}catch{return}const t=F().filter(g=>g.id!==o);y(t),this.articles=t;const s=I();s[o]&&(delete s[o],k(s)),v.success("已删除")},displayTags(o){return(Array.isArray(o)?o:typeof o=="string"?o.split(","):[]).join(",")},refreshDump(){const o={profile:this.profile,articles:this.articles,categories:this.categories,commentsMap:I()};this.dumpText=JSON.stringify(o,null,2)},downloadDump(){const o=new Blob([this.dumpText],{type:"application/json"}),t=URL.createObjectURL(o),s=document.createElement("a");s.href=t,s.download="blog-data-backup.json",s.click(),URL.revokeObjectURL(t),v.success("已下载备份文件")},async importDump(){try{const o=JSON.parse(this.dumpText);if(!o||typeof o!="object")throw new Error("JSON格式不正确");C(o.profile||{}),y(o.articles||[]),V(o.categories||[]),k(o.commentsMap||{}),this.loadAll(),v.success("数据已导入")}catch(o){x.alert(`导入失败：${o.message}`,"错误",{type:"error"})}},onAdminCoverChange(o){const t=o.target.files&&o.target.files[0];if(!t)return;const s=new FileReader;s.onload=()=>{this.articleForm.cover=s.result},s.readAsDataURL(t)},clearCover(){this.articleForm.cover="",this.$refs.adminCoverInput&&(this.$refs.adminCoverInput.value="")}}},S={class:"admin-container"},j={class:"tabs"},R={key:0,class:"card"},B={class:"grid"},J={class:"actions"},P={key:1,class:"card"},h={class:"list"},q={class:"item-actions"},z=["onClick"],G=["onClick"],H={key:0,class:"muted"},K={style:{"margin-top":"1rem"}},Q={class:"grid"},W={key:0,class:"cover-preview"},X=["src"],Y={class:"actions"},Z={class:"actions"},_={key:2,class:"card"},$={class:"list"},tt={class:"item-actions"},et=["onClick"],lt=["onClick"],rt={key:0,class:"muted"},ot={style:{"margin-top":"1rem"}},st={class:"grid"},it={class:"actions"},nt={key:3,class:"card"},mt={class:"actions",style:{"margin-bottom":".5rem"}},ut={class:"actions"};function at(o,t,s,g,r,i){const U=N("MdEditor");return d(),a("div",S,[t[50]||(t[50]=e("h1",null,"数据管理",-1)),e("div",j,[e("button",{class:b({active:r.tab==="profile"}),onClick:t[0]||(t[0]=l=>r.tab="profile")},"资料",2),e("button",{class:b({active:r.tab==="articles"}),onClick:t[1]||(t[1]=l=>r.tab="articles")},"文章",2),e("button",{class:b({active:r.tab==="categories"}),onClick:t[2]||(t[2]=l=>r.tab="categories")},"分类",2),e("button",{class:b({active:r.tab==="backup"}),onClick:t[3]||(t[3]=l=>r.tab="backup")},"备份/导入",2)]),r.tab==="profile"?(d(),a("section",R,[t[34]||(t[34]=e("h2",null,"个人资料",-1)),e("div",B,[e("label",null,[t[29]||(t[29]=n("昵称",-1)),m(e("input",{"onUpdate:modelValue":t[4]||(t[4]=l=>r.profile.name=l)},null,512),[[u,r.profile.name]])]),e("label",null,[t[30]||(t[30]=n("头衔",-1)),m(e("input",{"onUpdate:modelValue":t[5]||(t[5]=l=>r.profile.title=l)},null,512),[[u,r.profile.title]])]),e("label",null,[t[31]||(t[31]=n("邮箱",-1)),m(e("input",{"onUpdate:modelValue":t[6]||(t[6]=l=>r.profile.email=l)},null,512),[[u,r.profile.email]])]),e("label",null,[t[32]||(t[32]=n("微信",-1)),m(e("input",{"onUpdate:modelValue":t[7]||(t[7]=l=>r.profile.wechat=l)},null,512),[[u,r.profile.wechat]])]),e("label",null,[t[33]||(t[33]=n("简介",-1)),m(e("textarea",{"onUpdate:modelValue":t[8]||(t[8]=l=>r.profile.intro=l),rows:"4"},null,512),[[u,r.profile.intro]])])]),e("div",J,[e("button",{class:"primary",onClick:t[9]||(t[9]=(...l)=>i.saveProfile&&i.saveProfile(...l))},"保存资料")])])):c("",!0),r.tab==="articles"?(d(),a("section",P,[t[43]||(t[43]=e("h2",null,"文章管理",-1)),e("div",h,[(d(!0),a(A,null,w(r.articles,l=>(d(),a("div",{key:l.id,class:"list-item"},[e("div",null,[e("strong",null,"#"+p(l.id),1),n(" "+p(l.title)+" ",1),e("small",null,"分类: "+p(l.categoryId)+" | 标签: "+p(i.displayTags(l.tags)),1)]),e("div",q,[e("button",{onClick:f=>i.editArticle(l)},"编辑",8,z),e("button",{class:"danger",onClick:f=>i.deleteArticle(l.id)},"删除",8,G)])]))),128)),r.articles.length?c("",!0):(d(),a("div",H,"暂无文章"))]),e("h3",K,p(r.articleForm.id?"编辑文章":"新建文章"),1),e("div",Q,[e("label",null,[t[35]||(t[35]=n("标题",-1)),m(e("input",{"onUpdate:modelValue":t[10]||(t[10]=l=>r.articleForm.title=l)},null,512),[[u,r.articleForm.title]])]),e("label",null,[t[36]||(t[36]=n("分类ID",-1)),m(e("input",{type:"number","onUpdate:modelValue":t[11]||(t[11]=l=>r.articleForm.categoryId=l)},null,512),[[u,r.articleForm.categoryId,void 0,{number:!0}]])]),e("label",null,[t[37]||(t[37]=n("标签（逗号分隔）",-1)),m(e("input",{"onUpdate:modelValue":t[12]||(t[12]=l=>r.articleForm.tagsInput=l),placeholder:"如：Vue3,前端开发"},null,512),[[u,r.articleForm.tagsInput]])]),e("label",null,[t[38]||(t[38]=n("摘要",-1)),m(e("textarea",{"onUpdate:modelValue":t[13]||(t[13]=l=>r.articleForm.excerpt=l),rows:"3"},null,512),[[u,r.articleForm.excerpt]])]),e("label",null,[t[39]||(t[39]=n("封面图（URL）",-1)),m(e("input",{"onUpdate:modelValue":t[14]||(t[14]=l=>r.articleForm.cover=l),placeholder:"https://..."},null,512),[[u,r.articleForm.cover]])]),e("label",null,[t[40]||(t[40]=n(" 或选择本地封面 ",-1)),e("input",{type:"file",accept:"image/*",ref:"adminCoverInput",onChange:t[15]||(t[15]=(...l)=>i.onAdminCoverChange&&i.onAdminCoverChange(...l))},null,544),t[41]||(t[41]=e("span",{class:"muted"},"图片将以DataURL存储，建议不超过2MB",-1)),r.articleForm.cover?(d(),a("div",W,[e("img",{src:r.articleForm.cover,alt:"封面预览"},null,8,X),e("div",Y,[e("button",{onClick:t[16]||(t[16]=(...l)=>i.clearCover&&i.clearCover(...l))},"清除封面")])])):c("",!0)]),e("div",null,[t[42]||(t[42]=n(" 正文（Markdown） ",-1)),L(U,{modelValue:r.articleForm.content,"onUpdate:modelValue":t[17]||(t[17]=l=>r.articleForm.content=l),toolbars:["title","quote","unorderedList","orderedList","code"],autoFocus:!1,placeholder:"在此输入正文，点击插入代码可添加代码块"},null,8,["modelValue"])])]),e("div",Z,[e("button",{class:"primary",onClick:t[18]||(t[18]=(...l)=>i.saveArticle&&i.saveArticle(...l))},"保存文章"),e("button",{onClick:t[19]||(t[19]=(...l)=>i.resetArticleForm&&i.resetArticleForm(...l))},"重置")])])):c("",!0),r.tab==="categories"?(d(),a("section",_,[t[47]||(t[47]=e("h2",null,"分类管理",-1)),e("div",$,[(d(!0),a(A,null,w(r.categories,l=>(d(),a("div",{key:l.id,class:"list-item"},[e("div",null,[e("strong",null,"#"+p(l.id),1),n(" "+p(l.name)+" ",1),e("small",null,p(l.description),1)]),e("div",tt,[e("button",{onClick:f=>o.editCategory(l)},"编辑",8,et),e("button",{class:"danger",onClick:f=>o.deleteCategory(l.id)},"删除",8,lt)])]))),128)),r.categories.length?c("",!0):(d(),a("div",rt,"暂无分类"))]),e("h3",ot,p(r.categoryForm.id?"编辑分类":"新建分类"),1),e("div",st,[e("label",null,[t[44]||(t[44]=n("分类ID",-1)),m(e("input",{type:"number","onUpdate:modelValue":t[20]||(t[20]=l=>r.categoryForm.id=l),placeholder:"如：1"},null,512),[[u,r.categoryForm.id,void 0,{number:!0}]])]),e("label",null,[t[45]||(t[45]=n("名称",-1)),m(e("input",{"onUpdate:modelValue":t[21]||(t[21]=l=>r.categoryForm.name=l)},null,512),[[u,r.categoryForm.name]])]),e("label",null,[t[46]||(t[46]=n("描述",-1)),m(e("textarea",{"onUpdate:modelValue":t[22]||(t[22]=l=>r.categoryForm.description=l),rows:"3"},null,512),[[u,r.categoryForm.description]])])]),e("div",it,[e("button",{class:"primary",onClick:t[23]||(t[23]=(...l)=>o.saveCategory&&o.saveCategory(...l))},"保存分类"),e("button",{onClick:t[24]||(t[24]=(...l)=>o.resetCategoryForm&&o.resetCategoryForm(...l))},"重置")])])):c("",!0),r.tab==="backup"?(d(),a("section",nt,[t[48]||(t[48]=e("h2",null,"备份/导入",-1)),e("div",mt,[e("button",{onClick:t[25]||(t[25]=(...l)=>i.refreshDump&&i.refreshDump(...l))},"刷新当前数据"),e("button",{class:"primary",onClick:t[26]||(t[26]=(...l)=>i.downloadDump&&i.downloadDump(...l))},"下载备份JSON")]),m(e("textarea",{"onUpdate:modelValue":t[27]||(t[27]=l=>r.dumpText=l),rows:"10",placeholder:"当前数据JSON或粘贴要导入的JSON"},null,512),[[u,r.dumpText]]),e("div",ut,[e("button",{class:"primary",onClick:t[28]||(t[28]=(...l)=>i.importDump&&i.importDump(...l))},"导入覆盖")]),t[49]||(t[49]=e("p",{class:"muted"},"导入时将覆盖本地存储：资料、文章、分类、评论。",-1))])):c("",!0)])}const vt=T(O,[["render",at],["__scopeId","data-v-ccb5c656"]]);export{vt as default};
