import{s as C,k as v,m as k,j as x,i as I,a as y,g as b,h as A}from"./storage-CeQ8XAxi.js";import{_ as V,c as d,a as e,e as g,n as f,b as n,f as m,v as a,F as w,r as U,t as p,o as u}from"./index-CCxU4HIp.js";const D={name:"Admin",data(){return{tab:"profile",profile:{name:"",title:"",email:"",wechat:"",intro:""},articles:[],categories:[],articleForm:{id:null,title:"",categoryId:1,excerpt:"",content:"",tagsInput:""},categoryForm:{id:null,name:"",description:""},dumpText:""}},mounted(){this.loadAll()},methods:{loadAll(){this.profile=A(),this.articles=b(),this.categories=y(),this.refreshDump()},saveProfile(){C(this.profile),alert("资料已保存")},editArticle(i){this.tab="articles";const t=Array.isArray(i.tags)?i.tags:typeof i.tags=="string"?i.tags.split(","):[];this.articleForm={id:i.id,title:i.title,categoryId:i.categoryId,excerpt:i.excerpt,content:i.content||"",tagsInput:t.join(",")}},resetArticleForm(){this.articleForm={id:null,title:"",categoryId:1,excerpt:"",content:"",tagsInput:""}},saveArticle(){const i=this.articleForm.tagsInput.split(",").map(o=>o.trim()).filter(Boolean),t=b();if(this.articleForm.id){const o=t.findIndex(c=>c.id===this.articleForm.id);o>=0&&(t[o]={...t[o],title:this.articleForm.title,categoryId:this.articleForm.categoryId,excerpt:this.articleForm.excerpt,content:this.articleForm.content,tags:i})}else{const o=t.length?Math.max(...t.map(c=>c.id))+1:1;t.push({id:o,title:this.articleForm.title,publishTime:new Date().toISOString(),categoryId:this.articleForm.categoryId,excerpt:this.articleForm.excerpt,content:this.articleForm.content,tags:i,views:0,comments:0})}v(t),this.articles=t,this.resetArticleForm(),alert("文章已保存")},deleteArticle(i){if(!confirm("确定删除该文章？"))return;const t=b().filter(c=>c.id!==i);v(t),this.articles=t;const o=I();o[i]&&(delete o[i],x(o)),alert("已删除")},displayTags(i){return(Array.isArray(i)?i:typeof i=="string"?i.split(","):[]).join(", ")},editCategory(i){this.tab="categories",this.categoryForm={id:i.id,name:i.name,description:i.description||""}},resetCategoryForm(){this.categoryForm={id:null,name:"",description:""}},saveCategory(){const i=y(),t=i.findIndex(o=>o.id===this.categoryForm.id);t>=0?i[t]={...i[t],name:this.categoryForm.name,description:this.categoryForm.description}:i.push({id:this.categoryForm.id||(i.length?Math.max(...i.map(o=>o.id))+1:1),name:this.categoryForm.name,description:this.categoryForm.description}),k(i),this.categories=i,this.resetCategoryForm(),alert("分类已保存")},deleteCategory(i){if(!confirm("确定删除该分类？"))return;const t=y().filter(o=>o.id!==i);k(t),this.categories=t,alert("已删除")},refreshDump(){const i={profile:A(),articles:b(),categories:y(),comments:I()};this.dumpText=JSON.stringify(i,null,2)},importDump(){try{const i=JSON.parse(this.dumpText);if(!i||typeof i!="object")throw new Error("JSON 无效");i.profile&&C(i.profile),i.articles&&v(i.articles),i.categories&&k(i.categories),i.comments&&x(i.comments),this.loadAll(),alert("导入完成")}catch(i){alert("导入失败："+i.message)}},downloadDump(){const i=new Blob([this.dumpText],{type:"application/json"}),t=URL.createObjectURL(i),o=document.createElement("a");o.href=t,o.download="blog-backup.json",o.click(),URL.revokeObjectURL(t)}}},T={class:"admin-container"},h={class:"tabs"},j={key:0,class:"card"},N={class:"grid"},O={class:"actions"},S={key:1,class:"card"},L={class:"list"},M={class:"item-actions"},J=["onClick"],B=["onClick"],P={key:0,class:"muted"},R={style:{"margin-top":"1rem"}},E={class:"grid"},H={class:"actions"},z={key:2,class:"card"},q={class:"list"},G={class:"item-actions"},K=["onClick"],Q=["onClick"],W={key:0,class:"muted"},X={style:{"margin-top":"1rem"}},Y={class:"grid"},Z={class:"actions"},_={key:3,class:"card"},$={class:"actions",style:{"margin-bottom":".5rem"}},tt={class:"actions"};function et(i,t,o,c,r,s){return u(),d("div",T,[t[44]||(t[44]=e("h1",null,"数据管理",-1)),e("div",h,[e("button",{class:f({active:r.tab==="profile"}),onClick:t[0]||(t[0]=l=>r.tab="profile")},"资料",2),e("button",{class:f({active:r.tab==="articles"}),onClick:t[1]||(t[1]=l=>r.tab="articles")},"文章",2),e("button",{class:f({active:r.tab==="categories"}),onClick:t[2]||(t[2]=l=>r.tab="categories")},"分类",2),e("button",{class:f({active:r.tab==="backup"}),onClick:t[3]||(t[3]=l=>r.tab="backup")},"备份/导入",2)]),r.tab==="profile"?(u(),d("section",j,[t[31]||(t[31]=e("h2",null,"个人资料",-1)),e("div",N,[e("label",null,[t[26]||(t[26]=n("昵称",-1)),m(e("input",{"onUpdate:modelValue":t[4]||(t[4]=l=>r.profile.name=l)},null,512),[[a,r.profile.name]])]),e("label",null,[t[27]||(t[27]=n("头衔",-1)),m(e("input",{"onUpdate:modelValue":t[5]||(t[5]=l=>r.profile.title=l)},null,512),[[a,r.profile.title]])]),e("label",null,[t[28]||(t[28]=n("邮箱",-1)),m(e("input",{"onUpdate:modelValue":t[6]||(t[6]=l=>r.profile.email=l)},null,512),[[a,r.profile.email]])]),e("label",null,[t[29]||(t[29]=n("微信",-1)),m(e("input",{"onUpdate:modelValue":t[7]||(t[7]=l=>r.profile.wechat=l)},null,512),[[a,r.profile.wechat]])]),e("label",null,[t[30]||(t[30]=n("简介",-1)),m(e("textarea",{"onUpdate:modelValue":t[8]||(t[8]=l=>r.profile.intro=l),rows:"4"},null,512),[[a,r.profile.intro]])])]),e("div",O,[e("button",{class:"primary",onClick:t[9]||(t[9]=(...l)=>s.saveProfile&&s.saveProfile(...l))},"保存资料")])])):g("",!0),r.tab==="articles"?(u(),d("section",S,[t[37]||(t[37]=e("h2",null,"文章管理",-1)),e("div",L,[(u(!0),d(w,null,U(r.articles,l=>(u(),d("div",{key:l.id,class:"list-item"},[e("div",null,[e("strong",null,"#"+p(l.id),1),n(" "+p(l.title)+" ",1),e("small",null,"分类: "+p(l.categoryId)+" | 标签: "+p(s.displayTags(l.tags)),1)]),e("div",M,[e("button",{onClick:F=>s.editArticle(l)},"编辑",8,J),e("button",{class:"danger",onClick:F=>s.deleteArticle(l.id)},"删除",8,B)])]))),128)),r.articles.length?g("",!0):(u(),d("div",P,"暂无文章"))]),e("h3",R,p(r.articleForm.id?"编辑文章":"新建文章"),1),e("div",E,[e("label",null,[t[32]||(t[32]=n("标题",-1)),m(e("input",{"onUpdate:modelValue":t[10]||(t[10]=l=>r.articleForm.title=l)},null,512),[[a,r.articleForm.title]])]),e("label",null,[t[33]||(t[33]=n("分类ID",-1)),m(e("input",{type:"number","onUpdate:modelValue":t[11]||(t[11]=l=>r.articleForm.categoryId=l)},null,512),[[a,r.articleForm.categoryId,void 0,{number:!0}]])]),e("label",null,[t[34]||(t[34]=n("标签（逗号分隔）",-1)),m(e("input",{"onUpdate:modelValue":t[12]||(t[12]=l=>r.articleForm.tagsInput=l),placeholder:"如：Vue3,前端开发"},null,512),[[a,r.articleForm.tagsInput]])]),e("label",null,[t[35]||(t[35]=n("摘要",-1)),m(e("textarea",{"onUpdate:modelValue":t[13]||(t[13]=l=>r.articleForm.excerpt=l),rows:"3"},null,512),[[a,r.articleForm.excerpt]])]),e("label",null,[t[36]||(t[36]=n("正文（HTML）",-1)),m(e("textarea",{"onUpdate:modelValue":t[14]||(t[14]=l=>r.articleForm.content=l),rows:"6",placeholder:"可填写HTML内容"},null,512),[[a,r.articleForm.content]])])]),e("div",H,[e("button",{class:"primary",onClick:t[15]||(t[15]=(...l)=>s.saveArticle&&s.saveArticle(...l))},"保存文章"),e("button",{onClick:t[16]||(t[16]=(...l)=>s.resetArticleForm&&s.resetArticleForm(...l))},"重置")])])):g("",!0),r.tab==="categories"?(u(),d("section",z,[t[41]||(t[41]=e("h2",null,"分类管理",-1)),e("div",q,[(u(!0),d(w,null,U(r.categories,l=>(u(),d("div",{key:l.id,class:"list-item"},[e("div",null,[e("strong",null,"#"+p(l.id),1),n(" "+p(l.name)+" ",1),e("small",null,p(l.description),1)]),e("div",G,[e("button",{onClick:F=>s.editCategory(l)},"编辑",8,K),e("button",{class:"danger",onClick:F=>s.deleteCategory(l.id)},"删除",8,Q)])]))),128)),r.categories.length?g("",!0):(u(),d("div",W,"暂无分类"))]),e("h3",X,p(r.categoryForm.id?"编辑分类":"新建分类"),1),e("div",Y,[e("label",null,[t[38]||(t[38]=n("分类ID",-1)),m(e("input",{type:"number","onUpdate:modelValue":t[17]||(t[17]=l=>r.categoryForm.id=l),placeholder:"如：1"},null,512),[[a,r.categoryForm.id,void 0,{number:!0}]])]),e("label",null,[t[39]||(t[39]=n("名称",-1)),m(e("input",{"onUpdate:modelValue":t[18]||(t[18]=l=>r.categoryForm.name=l)},null,512),[[a,r.categoryForm.name]])]),e("label",null,[t[40]||(t[40]=n("描述",-1)),m(e("textarea",{"onUpdate:modelValue":t[19]||(t[19]=l=>r.categoryForm.description=l),rows:"3"},null,512),[[a,r.categoryForm.description]])])]),e("div",Z,[e("button",{class:"primary",onClick:t[20]||(t[20]=(...l)=>s.saveCategory&&s.saveCategory(...l))},"保存分类"),e("button",{onClick:t[21]||(t[21]=(...l)=>s.resetCategoryForm&&s.resetCategoryForm(...l))},"重置")])])):g("",!0),r.tab==="backup"?(u(),d("section",_,[t[42]||(t[42]=e("h2",null,"备份/导入",-1)),e("div",$,[e("button",{onClick:t[22]||(t[22]=(...l)=>s.refreshDump&&s.refreshDump(...l))},"刷新当前数据"),e("button",{class:"primary",onClick:t[23]||(t[23]=(...l)=>s.downloadDump&&s.downloadDump(...l))},"下载备份JSON")]),m(e("textarea",{"onUpdate:modelValue":t[24]||(t[24]=l=>r.dumpText=l),rows:"10",placeholder:"当前数据JSON或粘贴要导入的JSON"},null,512),[[a,r.dumpText]]),e("div",tt,[e("button",{class:"primary",onClick:t[25]||(t[25]=(...l)=>s.importDump&&s.importDump(...l))},"导入覆盖")]),t[43]||(t[43]=e("p",{class:"muted"},"导入时将覆盖本地存储：资料、文章、分类、评论。",-1))])):g("",!0)])}const rt=V(D,[["render",et],["__scopeId","data-v-e7372762"]]);export{rt as default};
