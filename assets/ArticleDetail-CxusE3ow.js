import{l as f,c as C,d as y,e as w,f as x,a as b}from"./storage-Dkmu0FnL.js";import{r as k}from"./index-C2exR0dF.js";import{_ as A,c as l,o,a as e,d as M,e as m,t as r,n as T,F as v,r as g,f as z,b as h,g as D,v as I,E as u,h as L}from"./index-DqUWjSwh.js";const B={name:"ArticleDetail",components:{MdPreview:k},data(){return{article:null,prevArticle:null,nextArticle:null,comments:[],newComment:"",categories:[{id:1,name:"技术分享"},{id:2,name:"生活随笔"},{id:3,name:"资源记录"},{id:4,name:"项目经验"}]}},created(){this.fetchArticleDetail()},methods:{async fetchArticleDetail(){try{const s=parseInt(this.$route.params.id),t=y(s);if(!t)throw new Error("文章不存在");this.article={...t,tags:Array.isArray(t.tags)?t.tags:typeof t.tags=="string"?t.tags.split(","):[],publishTime:new Date(t.publishTime)},this.comments=w(s).map(d=>({...d,time:new Date(d.time)}));const a=x(s);this.prevArticle=a.prev,this.nextArticle=a.next,this.categories=b()}catch(s){console.error("加载文章详情失败:",s)}},submitComment(){if(!this.newComment.trim()){u.warning("请输入评论内容");return}const s=C(this.article.id,this.newComment.trim(),"当前用户");this.comments.push({...s,time:new Date(s.time)}),this.newComment="",u.success("评论提交成功")},likeComment(s){f(this.article.id,s);const t=this.comments.findIndex(a=>a.id===s);t>=0&&(this.comments[t].likes+=1)},formatDate(s){const t=new Date(s);return`${t.getFullYear()}-${String(t.getMonth()+1).padStart(2,"0")}-${String(t.getDate()).padStart(2,"0")}`},getCategoryName(s){const t=this.categories.find(a=>a.id===s);return t?t.name:"未分类"},goToArticle(s){this.$router.push(`/article/${s}`)},goToTag(s){this.$router.push(`/tags/${s}`)}},computed:{isLegacyHtml(){const s=this.article&&this.article.content;return typeof s=="string"&&/<div\s+class="rich-content">[\s\S]*<\/div>/.test(s)},legacyInnerHtml(){const s=this.article&&this.article.content;if(!s)return"";const t=/<div\s+class="rich-content">([\s\S]*?)<\/div>/.exec(s);return t?t[1]:s},sanitizedLegacyHtml(){const s=this.legacyInnerHtml||"",t=this.article&&this.article.cover;if(!s)return"";let a=s;if(t)try{const d=t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),i=new RegExp(`<img[^>]*src=["']${d}["'][^>]*>`,"gi");a=a.replace(i,"")}catch{}return a=a.replace(/<img[^>]*>/i,""),a},sanitizedMarkdown(){const s=this.article&&this.article.content||"",t=this.article&&this.article.cover;if(!s)return"";let a=s;if(t)try{const d=t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),i=new RegExp(`!\\[[^\\]]*\\]\\(\\s*${d}\\s*(?:"[^"]*")?\\)`,"g"),n=new RegExp(`<img[^>]*src=["']${d}["'][^>]*>`,"gi");a=a.replace(i,"").replace(n,"")}catch{}return a=a.replace(/!\[[^\]]*\]\([^)]*\)/,""),a=a.replace(/<img[^>]*>/i,""),a}}},S={class:"article-detail-container"},H={class:"article-wrapper"},E={key:0,class:"article-content"},N={class:"article-header"},V={class:"article-title"},P={class:"article-meta"},F={class:"publish-time"},R={class:"read-time"},j={class:"article-tags"},U=["onClick"],Y={key:0,class:"detail-cover"},q=["src"],G={class:"article-body"},J=["innerHTML"],K={class:"article-stats"},O={class:"stat-item"},Q={class:"stat-item"},W={class:"article-nav"},X={class:"nav-title"},Z={class:"nav-title"},$={class:"comment-section"},tt={class:"comment-title"},et={class:"comment-input-area"},st={class:"comment-list"},it={class:"comment-avatar"},at={class:"comment-content"},ct={class:"comment-header"},rt={class:"comment-author"},nt={class:"comment-time"},ot={class:"comment-text"},lt={class:"comment-actions"},dt=["onClick"],mt={key:1,class:"loading"};function ht(s,t,a,d,i,n){const p=L("MdPreview");return o(),l("div",S,[e("div",H,[i.article?(o(),l("div",E,[e("div",N,[e("h1",V,r(i.article.title),1),e("div",P,[e("span",F,r(n.formatDate(i.article.publishTime)),1),e("span",{class:T(["category",`category-${i.article.categoryId}`])},r(n.getCategoryName(i.article.categoryId)),3),e("span",R,r(i.article.readTime)+" 分钟阅读",1)]),e("div",j,[(o(!0),l(v,null,g(i.article.tags,c=>(o(),l("span",{key:c,class:"tag",onClick:_=>n.goToTag(c)}," #"+r(c),9,U))),128))]),i.article.cover?(o(),l("div",Y,[e("img",{src:i.article.cover,alt:"文章封面",class:"cover-img",loading:"lazy",decoding:"async",style:{"max-width":"100%",width:"100%",height:"auto","aspect-ratio":"16/9","max-height":"420px","object-fit":"cover","border-radius":"8px"}},null,8,q)])):m("",!0)]),e("div",G,[n.isLegacyHtml?(o(),l("div",{key:0,innerHTML:n.sanitizedLegacyHtml},null,8,J)):(o(),z(p,{key:1,modelValue:n.sanitizedMarkdown},null,8,["modelValue"]))]),e("div",K,[e("div",O,[t[4]||(t[4]=e("svg",{class:"icon",viewBox:"0 0 16 16",fill:"currentColor"},[e("path",{d:"M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.012 8.012 0 0 0 16 8c0-4.42-3.58-8-8-8z"})],-1)),h(" "+r(i.article.views),1)]),e("div",Q,[t[5]||(t[5]=e("svg",{class:"icon",viewBox:"0 0 16 16",fill:"currentColor"},[e("path",{d:"M2.678 11.894a1 1 0 0 1 .287.801 10.97 10.97 0 0 0 .398 2c1.395-.323 2.247-.697 2.634-.893a1 1 0 0 1 .71-.074A8.06 8.06 0 0 0 8 14c3.996 0 7-2.807 7-6 0-3.192-3.004-6-7-6S1 4.808 1 8c0 1.468.617 2.83 1.678 3.894zm-.493 3.905a21.682 21.682 0 0 1-.713.129c-.2.032-.352-.176-.273-.362a9.68 9.68 0 0 0 .244-.637l.003-.01c.248-.72.45-1.548.524-2.319C.743 11.37 0 9.76 0 8c0-3.866 3.582-7 8-7s8 3.134 8 7-3.582 7-8 7a9.06 9.06 0 0 1-2.347-.306c-.52.263-1.639.742-3.468 1.105z"})],-1)),h(" "+r(i.article.comments),1)])]),t[9]||(t[9]=M('<div class="share-buttons" data-v-90344df6><button class="share-btn share-wechat" data-v-90344df6><svg class="icon" viewBox="0 0 16 16" fill="currentColor" data-v-90344df6><path d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.012 8.012 0 0 0 16 8c0-4.42-3.58-8-8-8z" data-v-90344df6></path></svg> 微信 </button><button class="share-btn share-weibo" data-v-90344df6><svg class="icon" viewBox="0 0 16 16" fill="currentColor" data-v-90344df6><path d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.012 8.012 0 0 0 16 8c0-4.42-3.58-8-8-8z" data-v-90344df6></path></svg> 微博 </button><button class="share-btn share-link" data-v-90344df6><svg class="icon" viewBox="0 0 16 16" fill="currentColor" data-v-90344df6><path d="M4.715 6.542L3.343 7.914a3 3 0 1 0 4.243 4.243l1.828-1.829A3 3 0 0 0 8.586 5.5L8 6.086a1.002 1.002 0 0 0-.154.199 2 2 0 0 1 .861 3.337L6.88 11.45a2 2 0 1 1-2.83-2.83l.793-.792a4.018 4.018 0 0 1-.128-1.287z" data-v-90344df6></path><path d="M6.586 4.672A3 3 0 0 0 7.414 9.5l.775-.776a2 2 0 0 1-.896-3.346L9.12 3.55a2 2 0 1 1 2.83 2.83l-.793.792c.112.42.155.855.128 1.287l1.372-1.372a3 3 0 1 0-4.243-4.243L6.586 4.672z" data-v-90344df6></path></svg> 复制链接 </button></div>',1)),e("div",W,[i.prevArticle?(o(),l("div",{key:0,class:"prev-article",onClick:t[0]||(t[0]=c=>n.goToArticle(i.prevArticle.id))},[t[6]||(t[6]=e("span",{class:"nav-label"},"上一篇",-1)),e("span",X,r(i.prevArticle.title),1)])):m("",!0),i.nextArticle?(o(),l("div",{key:1,class:"next-article",onClick:t[1]||(t[1]=c=>n.goToArticle(i.nextArticle.id))},[t[7]||(t[7]=e("span",{class:"nav-label"},"下一篇",-1)),e("span",Z,r(i.nextArticle.title),1)])):m("",!0)]),e("div",$,[e("h3",tt,"评论 ("+r(i.comments.length)+")",1),e("div",et,[D(e("textarea",{"onUpdate:modelValue":t[2]||(t[2]=c=>i.newComment=c),placeholder:"写下你的评论...",rows:"4"},null,512),[[I,i.newComment]]),e("button",{class:"submit-comment",onClick:t[3]||(t[3]=(...c)=>n.submitComment&&n.submitComment(...c))},"提交评论")]),e("div",st,[(o(!0),l(v,null,g(i.comments,c=>(o(),l("div",{key:c.id,class:"comment-item"},[e("div",it,r(c.author.charAt(0)),1),e("div",at,[e("div",ct,[e("span",rt,r(c.author),1),e("span",nt,r(n.formatDate(c.time)),1)]),e("div",ot,r(c.content),1),e("div",lt,[e("button",{class:"like-btn",onClick:_=>n.likeComment(c.id)},[t[8]||(t[8]=e("svg",{class:"icon",viewBox:"0 0 16 16",fill:"currentColor"},[e("path",{d:"M8 1.314C12.438-3.248 23.534 4.735 8 15-7.534 4.736 3.562-3.248 8 1.314z"})],-1)),h(" "+r(c.likes),1)],8,dt)])])]))),128))])])])):(o(),l("div",mt,"加载中..."))])])}const pt=A(B,[["render",ht],["__scopeId","data-v-90344df6"]]);export{pt as default};
